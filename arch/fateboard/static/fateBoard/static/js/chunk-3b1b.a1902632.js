(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3b1b"],{"7Qib":function(t,n,e){"use strict";e.d(n,"b",function(){return s}),e.d(n,"a",function(){return i});e("jWXv"),e("rfXi"),e("gDS+"),e("GQeE");var a=e("EJiy"),o=e.n(a);function s(t,n){if(0===arguments.length)return null;var e=n||"{y}-{m}-{d} {h}:{i}:{s}",a=void 0;"object"===(void 0===t?"undefined":o()(t))?a=t:("string"==typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"==typeof t&&10===t.toString().length&&(t*=1e3),a=new Date(t));var s={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()};return e.replace(/{(y|m|d|h|i|s|a)+}/g,function(t,n){var e=s[n];return"a"===n?["日","一","二","三","四","五","六"][e]:(t.length>0&&e<10&&(e="0"+e),e||0)})}function i(t){var n=Math.floor(t/3600),e=Math.floor(t/60%60),a=Math.floor(t%60),o=function(t){return t<1?"00":t<10?"0"+t:t.toString()};return(n=o(n))+":"+(e=o(e))+":"+(a=o(a))}},"7z+L":function(t,n,e){var a=e("gYtT");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,e("SZ7m").default)("12b0fd0e",a,!0,{})},"9g82":function(t,n,e){"use strict";e.r(n);var a=e("m1cH"),o=e.n(a),s=e("Yulh"),i={tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{title:{show:!1},name:"业务指标",type:"gauge",detail:{show:!0,formatter:"{value}%",offsetCenter:[0,"30%"],fontWeight:"lighter",fontSize:13},axisLine:{lineStyle:{color:[[.3,"#67e0e3"],[.7,"#37a2da"],[1,"#0abd00"]],width:20}},pointer:{show:!0},data:[{value:0,name:"完成率"}]}]},r=e("lAiS"),l=e("bZCS"),c=e("7Qib"),d=e("dv4G"),h={components:{EchartContainer:s.a},data:function(){return{jobOptions:i,graphOptions:r.a,dataset:{dataset:"",target:"",columns:"",row:"",partner:"",pnr_dataset:""},jobStatus:"waiting...",datasetLoading:!0,logLoading:!1,jobTimer:null,logWebsocket:null,jobWebsocket:null,logs:[],jobId:this.$route.query.jobId,DAGData:null,gaugeInstance:null,elapsed:""}},mounted:function(){var t=this;Object(d.e)(this.jobId).then(function(n){t.datasetLoading=!1,t.dataset=n.data.dataset}),Object(d.d)(this.jobId).then(function(n){t.DAGData=n.data}),this.logWebsocket=this.initWebSocket("/log/default/"+this.jobId+"/1",function(t){console.log("日志推送websocket连接成功")},function(n){t.logs.push(JSON.parse(n.data))}),this.jobWebsocket=this.initWebSocket("/websocket/progress/"+this.jobId,function(t){console.log("job推送websocket连接成功")},function(n){if("faied"!==t.jobStatus){var e=JSON.parse(n.data),a=e.process,o=e.status,s=e.time;"running"===o&&(t.elapsed=Object(c.a)(s),t.jobStatus="running...",t.jobOptions.series[0].pointer.show=!0,t.jobOptions.series[0].detail.show=!0,t.jobOptions.series[0].data[0].value=a,t.gaugeInstance.setOption(t.jobOptions,!0))}})},beforeDestroy:function(){clearInterval(this.jobTimer),this.closeWebsocket()},methods:{getJobEchartInstance:function(t){this.gaugeInstance=t},closeWebsocket:function(){console.log("close Websocket"),this.logWebsocket.close(),this.jobWebsocket.close(),this.logWebsocket=null,this.jobWebsocket=null},killJob:function(){var t=this;console.log(this.jobWebsocket),this.$confirm("You can't undo this action","Are you sure you want to kill this job?",{confirmButtonText:"Sure",cancelButtonText:"Cancel",type:"warning"}).then(function(){t.jobStatus="faied"}).catch(function(){console.log("cancel kill")})},tWaitJob:function(){clearInterval(this.jobTimer),this.jobStatus="waiting...",this.jobOptions.series[0].pointer.show=!1,this.jobOptions.series[0].detail.show=!1,this.gaugeInstance.setOption(this.jobOptions,!0)},tRunJob:function(){var t=this;this.jobStatus="running...",this.jobOptions.series[0].pointer.show=!0,this.jobOptions.series[0].detail.show=!0,this.jobTimer=setInterval(function(){t.jobOptions.series[0].data[0].value=(100*Math.random()).toFixed(2)-0,t.gaugeInstance.setOption(t.jobOptions,!0)},2e3)},tCompJob:function(){this.jobStatus="complete"},getGraphEchartInstance:function(t){var n=this,e=null;e=window.setInterval(function(){if(n.DAGData){window.clearInterval(e);var a=Object(l.a)(n.DAGData),o=a.dataList,s=a.linksList;n.graphOptions.series[0].data=o,n.graphOptions.series[0].links=s,t.setOption(n.graphOptions,!0),t.on("click",{dataType:"node"},function(t){console.log(t)})}},100)},initWebSocket:function(t,n,e){var a=this,o=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],new WebSocket("ws://172.16.153.113:16688"+t));return o.onopen=n,o.onmessage=e,o.onerror=function(){a.initWebSocket(t,o)},o.onclose=function(){console.log("关闭websocket连接")},o},toDetails:function(t){this.$router.push({path:"/details",query:{jobId:t,from:"Dashboard"}})},logOnMousewheel:function(t){var n=this,e=this.logs[0];if(e){var a=e.lineNum-1;if(a>0&&0===t.target.parentNode.parentNode.scrollTop&&(t.wheelDelta>0||t.detail>0)){this.logLoading=!0;var s=a-10>1?a-10:1;Object(d.h)({componentId:"default",jobId:this.jobId,begin:s,end:a}).then(function(t){var e=[];t.data.map(function(t){e.push(JSON.parse(t))}),console.log(e),n.logs=[].concat(e,o()(n.logs)),n.logLoading=!1})}}}}},u=(e("lJfc"),e("KHd+")),p=Object(u.a)(h,function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"dashboard-container bg-dark"},[e("div",{staticClass:"top flex space-between"},[e("span",[t._v("Dashboard")]),t._v(" "),e("p",[t._v("Job: "),e("span",{staticClass:"text-primary pointer",on:{click:function(n){t.toDetails(t.jobId)}}},[t._v(t._s(t.jobId))])])]),t._v(" "),e("ul",{staticClass:"dash-board-list flex center justify-center flex-wrap"},[e("li",{directives:[{name:"loading",rawName:"v-loading",value:t.datasetLoading,expression:"datasetLoading"}],staticClass:"dataset-info"},[e("h3",{staticClass:"list-title"},[t._v("DATASET INFO")]),t._v(" "),e("h3",{staticClass:"title"},[t._v("GUEST")]),t._v(" "),e("ul",{staticClass:"info-row"},[e("li",[e("h4",{staticClass:"name"},[t._v("DATASET")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.dataset))])]),t._v(" "),e("li",[e("h4",{staticClass:"name"},[t._v("TARGET")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.target))])])]),t._v(" "),e("ul",{staticClass:"info-row"},[e("li",[e("h4",{staticClass:"name"},[t._v("COLUMNS")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.columns))])]),t._v(" "),e("li",[e("h4",{staticClass:"name"},[t._v("ROWS")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.row))])])]),t._v(" "),e("h3",{staticClass:"title"},[t._v("HOST")]),t._v(" "),e("ul",{staticClass:"info-row"},[e("li",[e("h4",{staticClass:"name"},[t._v("PARTNER")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.partner))])]),t._v(" "),e("li",[e("h4",{staticClass:"name"},[t._v("PNR-DATASET")]),t._v(" "),e("p",{staticClass:"value"},[t._v(t._s(t.dataset.pnr_dataset))])])])]),t._v(" "),e("li",{staticClass:"job flex-center justify-center"},[e("h3",{staticClass:"list-title"},[t._v("JOB")]),t._v(" "),"faied"===t.jobStatus||"complete"===t.jobStatus?e("div",{staticClass:"job-end-container flex flex-col flex-center"},[e("i",{staticClass:"el-icon-circle-close job-icon icon-error",staticStyle:{"margin-bottom":"20px",color:"#f04134","font-size":"50px"}}),t._v(" "),t._m(0),t._v(" "),e("el-button",{on:{click:function(n){t.toDetails(t.jobId)}}},[t._v("VIEW THIS JOB")])],1):e("div",{staticClass:"echarts-container"},[t.elapsed?e("div",{staticClass:"elapsed"},[e("p",{staticClass:"elapsed-title"},[t._v("ELAPSED")]),t._v(" "),e("p",{staticClass:"text-primary"},[t._v(t._s(t.elapsed))])]):t._e(),t._v(" "),e("echart-container",{class:"echarts",attrs:{options:t.jobOptions},on:{getEchartInstance:t.getJobEchartInstance}}),t._v(" "),e("div",{staticClass:"bottom-wrapper w-100 flex flex-col flex-center"},[e("span",{staticClass:"status"},[t._v(t._s(t.jobStatus))]),t._v(" "),e("div",{staticClass:"flex space-around",staticStyle:{width:"100%"}},[e("el-button",{staticClass:"btn",on:{click:t.killJob}},[t._v("KILL")])],1)])],1)]),t._v(" "),e("li",{directives:[{name:"loading",rawName:"v-loading",value:!t.DAGData,expression:"!DAGData"}],staticClass:"graph flex-center justify-center"},[e("h3",{staticClass:"list-title"},[t._v("GRAPH")]),t._v(" "),e("echart-container",{class:"echarts",attrs:{options:t.graphOptions},on:{getEchartInstance:t.getGraphEchartInstance}})],1)]),t._v(" "),e("div",{staticClass:"log-wrapper"},[e("el-tabs",{attrs:{type:"border-card"}},[e("el-tab-pane",[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("All")]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.logLoading,expression:"logLoading"}],staticClass:"log-container",on:{mousewheel:t.logOnMousewheel}},[e("ul",{staticClass:"log-list"},t._l(t.logs,function(n,a){return e("li",{key:a},[e("span",{staticStyle:{color:"#999","margin-right":"5px"}},[t._v(t._s(n.lineNum))]),t._v("\n              "+t._s(n.content)+"\n            ")])}))])]),t._v(" "),e("el-tab-pane",[e("span",{attrs:{slot:"label"},slot:"label"},[e("el-badge",{staticClass:"item",attrs:{value:12}},[t._v("Error")])],1),t._v("\n        Error\n      ")]),t._v(" "),e("el-tab-pane",[e("span",{attrs:{slot:"label"},slot:"label"},[e("el-badge",{staticClass:"item",attrs:{value:12,type:"warning"}},[t._v("Warning")])],1),t._v("\n        Warning\n      ")]),t._v(" "),e("el-tab-pane",[e("span",{attrs:{slot:"label"},slot:"label"},[e("el-badge",{staticClass:"item",attrs:{value:12,type:"info"}},[t._v("Info")])],1),t._v("\n        Info\n      ")])],1)],1)])},[function(){var t=this.$createElement,n=this._self._c||t;return n("ul",{staticClass:"job-info flex space-around flex-wrap w-100"},[n("li",[n("p",{staticClass:"name"},[this._v("status")]),this._v(" "),n("p",{staticClass:"value"},[this._v("FAIED")])]),this._v(" "),n("li",[n("p",{staticClass:"name"},[this._v("duration")]),this._v(" "),n("p",{staticClass:"value"},[this._v("00:30:35")])])])}],!1,null,null,null);p.options.__file="index.vue";n.default=p.exports},TJnn:function(t,n,e){"use strict";var a=e("7z+L");e.n(a).a},Yulh:function(t,n,e){"use strict";var a=e("MT78"),o=e.n(a),s={props:{className:{type:String,default:""},id:{type:String,default:""},options:{type:Object,default:function(){return null}}},data:function(){return{echarts:o.a,echartInstance:null}},mounted:function(){this.initChart()},beforeDestroy:function(){this.echartInstance&&(this.echartInstance.dispose(),this.echartInstance=null,window.removeEventListener("resize",this.resize))},methods:{initChart:function(){this.echartInstance=this.echarts.init(this.$refs.myEchart),window.addEventListener("resize",this.resize),this.$emit("getEchartInstance",this.echartInstance),this.$emit("getEchart",this.echarts),this.echartInstance.setOption(this.options)},resize:function(){this.echartInstance.resize()}}},i=(e("TJnn"),e("KHd+")),r=Object(i.a)(s,function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"myEchart",class:this.className,attrs:{id:this.id}})},[],!1,null,null,null);r.options.__file="index.vue";n.a=r.exports},bZCS:function(t,n,e){"use strict";n.a=function(t){for(var n=(t=t||{dependencies:{node2:["node1"],node3:["node2"],node4:["node2"],node5:["node3","node4"],node6:["node5"]},components_list:["node1","node2","node3","node4","node5","node6"]}).dependencies,e=t.components_list,a=0,o=0,s=[],i=[],r=[],l=function(t){var l=n[e[t]];if(l){for(var c=0;c<l.length;c++)r.push({target:t,source:e.indexOf(l[c])});var d=null;i.forEach(function(t){t.name===l[0]&&(d=t)}),a<=d.level?(++a,s.push(o),o=1):++o,t===e.length-1&&s.push(o)}else++o;i.push({name:e[t],level:a,index:o})},c=0;c<e.length;c++)l(c);var d=Math.max.apply(Math,s),h=10*(d-1);return i.map(function(t){var n=s[t.level],e=0;e=n===d?10*(t.index-1):h/(n+1)*t.index,t.x=e,t.y=10*t.level}),{dataList:i,linksList:r}}},dv4G:function(t,n,e){"use strict";e.d(n,"a",function(){return o}),e.d(n,"b",function(){return s}),e.d(n,"g",function(){return i}),e.d(n,"e",function(){return r}),e.d(n,"d",function(){return l}),e.d(n,"c",function(){return c}),e.d(n,"f",function(){return d}),e.d(n,"h",function(){return h});var a=e("t3Un");function o(t){return Object(a.a)({url:"/job/query/all",method:"get",params:t})}function s(t){return Object(a.a)({url:"/job/query/status",method:"get",params:t})}function i(t){return Object(a.a)({url:"/job/v1/pipeline/job/stop",method:"post",data:{job_id:t}})}function r(t){return Object(a.a)({url:"/job/query/"+t,method:"get"})}function l(t){return Object(a.a)({url:"/v1/pipeline/dag/dependencies",method:"post",data:{job_id:t}})}function c(t){return Object(a.a)({url:"/v1/tracking/component/parameters",method:"post",data:t})}function d(t){return Object(a.a)({url:"/v1/tracking/component/output/model",method:"post",data:t})}function h(t){var n=t.componentId,e=t.jobId,o=t.begin,s=t.end;return Object(a.a)({url:"/queryLogWithSize/"+n+"/"+e+"/"+o+"/"+s+"  ",method:"get"})}},gYtT:function(t,n,e){(t.exports=e("I1BE")(!1)).push([t.i,"\n.default-echart {\n  width: 75vw;\n  height: 75vh;\n}\n",""])},lAiS:function(t,n,e){"use strict";n.a={tooltip:{},series:[{type:"graph",layout:"none",roam:!1,label:{show:!0,color:"#333",borderWidth:1,borderRadius:2,borderColor:"#333",padding:5,lineHeight:20,rich:{a:{color:"red",lineHeight:10},x:{fontSize:18,fontFamily:"Microsoft YaHei",borderColor:"#449933",borderRadius:4}}},symbol:"rect",symbolSize:[50,20],edgeSymbol:["circle","arrow"],edgeSymbolSize:[4,10],edgeLabel:{normal:{textStyle:{fontSize:20}}},data:[],links:[],itemStyle:{color:"#fff"},lineStyle:{normal:{opacity:.9,width:2,curveness:0}}}]}},lJfc:function(t,n,e){"use strict";var a=e("p9cb");e.n(a).a},m1cH:function(t,n,e){"use strict";n.__esModule=!0;var a=function(t){return t&&t.__esModule?t:{default:t}}(e("rfXi"));n.default=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return(0,a.default)(t)}},p9cb:function(t,n,e){var a=e("xWUn");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,e("SZ7m").default)("01df6e23",a,!0,{})},xWUn:function(t,n,e){(t.exports=e("I1BE")(!1)).push([t.i,'@charset "UTF-8";\n.dashboard-container {\n  height: 100%;\n  padding: 50px calc((10vw - 30px) / 2);\n}\n.dashboard-container .top {\n    margin-bottom: 20px;\n    padding-bottom: 5px;\n    border-bottom: 1px solid;\n    line-height: 25px;\n}\n.dashboard-container .dash-board-list {\n    /*仪表盘job进度图*/\n}\n.dashboard-container .dash-board-list > li {\n      width: 28vw;\n      height: 40vh;\n      margin: 5px 10px;\n      background: #fff;\n}\n.dashboard-container .dash-board-list > li .list-title {\n        height: 40px;\n        line-height: 40px;\n        text-indent: 10px;\n}\n.dashboard-container .dash-board-list > li .echarts-container {\n        width: 100%;\n        height: 100%;\n        position: relative;\n}\n.dashboard-container .dash-board-list .dataset-info {\n      -webkit-box-orient: vertical;\n      -webkit-box-direction: normal;\n          -ms-flex-direction: column;\n              flex-direction: column;\n      padding: 0 20px 20px 20px;\n}\n.dashboard-container .dash-board-list .dataset-info .title {\n        margin-bottom: 10px;\n}\n.dashboard-container .dash-board-list .dataset-info .info-row {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -ms-flex-pack: distribute;\n            justify-content: space-around;\n}\n.dashboard-container .dash-board-list .dataset-info .info-row > li {\n          width: 35%;\n          margin-bottom: 10px;\n}\n.dashboard-container .dash-board-list .dataset-info .info-row > li .name {\n            margin-bottom: 5px;\n}\n.dashboard-container .dash-board-list .job .echarts {\n      width: 28vw;\n      height: calc(40vh - 40px);\n      /*top: 5%;*/\n}\n.dashboard-container .dash-board-list .job .elapsed {\n      position: absolute;\n      top: 20px;\n      right: 30px;\n}\n.dashboard-container .dash-board-list .job .elapsed .elapsed-title {\n        color: #999;\n        font-size: 14px;\n}\n.dashboard-container .dash-board-list .job .job-end-container {\n      width: 28vw;\n      height: calc(40vh - 40px);\n}\n.dashboard-container .dash-board-list .job .job-end-container .job-info > li {\n        width: 28%;\n        padding: 0 5%;\n        margin-bottom: 20px;\n}\n.dashboard-container .dash-board-list .job .job-end-container .job-info > li .name {\n          font-size: 12px;\n          color: #999;\n}\n.dashboard-container .dash-board-list .job .bottom-wrapper {\n      position: absolute;\n      bottom: 50px;\n      left: 0;\n}\n.dashboard-container .dash-board-list .job .bottom-wrapper .status {\n        margin-bottom: 5px;\n        font-size: 14px;\n}\n.dashboard-container .dash-board-list .job .bottom-wrapper .btn {\n        padding: 5px 25px;\n}\n.dashboard-container .graph .echarts {\n    width: 28vw;\n    height: calc(40vh - 40px);\n    /*top: 5%;*/\n}\n.dashboard-container .log-wrapper {\n    margin: 10px 5px;\n}\n.dashboard-container .log-wrapper .el-badge {\n      padding-right: 10px;\n}\n.dashboard-container .log-wrapper .el-badge__content.is-fixed {\n      top: 10px;\n}\n.dashboard-container .log-wrapper .log-container {\n      height: 32vh;\n      overflow: auto;\n}\n.dashboard-container .log-wrapper .log-container .log-list > li {\n        /*height: 25px;*/\n        line-height: 25px;\n        text-indent: 10px;\n}\n',""])}}]);